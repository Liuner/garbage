package utilsTest;

import cn.hutool.core.util.ObjectUtil;
import com.alibaba.fastjson2.JSON;
import com.alibaba.fastjson2.JSONObject;
import com.own.garbage.core.utils.JSONUtil;
import org.junit.Test;

import java.util.List;
import java.util.Map;
import java.util.function.Function;
import java.util.stream.Collectors;

/**
 * @ClassName JSONUtilTest
 * @Description
 * @Author liugs
 * @Date 2023/8/7 0007 16:13
 */
public class JSONUtilTest {

    @Test
    public void testFlat() {
        String target = "[{\"title\":\"背景文字\",\"alignment\":1,\"type\":\"backgroundText\",\"typeFlag\":2,\"name\":\"联系我们\",\"textSize\":\"24\",\"topMargin\":\"20\",\"bottomMargin\":\"16\",\"leftMargin\":\"20\",\"rightMargin\":0,\"backgroundShow\":2,\"textShow\":1,\"backgroundColor\":\"rgba(255,255,255,1)\",\"backgroundColor1\":\"#FDEEBC\",\"backgroundColor2\":\"#DCB367\",\"direction\":\"right\",\"textColor\":\"#181818\",\"conversWidth\":1200,\"contentWidth\":\"1176\",\"width\":1536,\"height\":60,\"w\":90,\"h\":3,\"hTotal\":48,\"componentContent\":{\"imgFlag\":1,\"imgUrl\":\"static/img/baner3.4ef67394.png\"},\"x\":5,\"y\":9.600000000000001,\"i\":\"CSyNH7yRW\",\"isEmpty\":false,\"moved\":false,\"index\":0,\"imgWidth1\":1176,\"imgHeight1\":60},{\"title\":\"背景文字\",\"alignment\":2,\"type\":\"backgroundText\",\"typeFlag\":2,\"name\":\"频道广场\",\"textSize\":28,\"topMargin\":0,\"bottomMargin\":0,\"leftMargin\":0,\"rightMargin\":0,\"backgroundShow\":2,\"textShow\":2,\"backgroundColor\":\"rgba(243,243,243,1)\",\"backgroundColor1\":\"#FDEEBC\",\"backgroundColor2\":\"#DCB367\",\"direction\":\"right\",\"textColor\":\"#000\",\"conversWidth\":1200,\"contentWidth\":\"1176\",\"width\":1536,\"height\":16,\"w\":90,\"h\":0.8,\"hTotal\":48,\"componentContent\":{\"imgFlag\":1,\"imgUrl\":\"static/img/baner3.4ef67394.png\"},\"x\":5,\"y\":8.8,\"i\":\"CXicjMtYs\",\"isEmpty\":false,\"moved\":false,\"index\":2,\"newHeight\":\"16\",\"imgWidth1\":1176,\"imgHeight1\":16},{\"title\":\"信息模板\",\"type\":\"textComponent\",\"contentWidth\":\"1176\",\"backgroundColor\":\"white\",\"lineHeight\":54,\"marginRight\":29,\"marginLeft\":21,\"partitionColor\":\"#EEEEEE\",\"w\":90,\"h\":25.9,\"componentContent\":{\"textData\":[{\"textFlag\":1,\"title\":\"联系人\",\"titleContent\":\"徐工\",\"textContent\":\"这是一段文本\",\"top\":\"21\",\"right\":0,\"bottom\":0,\"left\":\"80\",\"titleSize\":\"24\",\"titleColor\":\"#000\",\"contentSize\":\"24\",\"contentColor\":\"#000\"},{\"textFlag\":1,\"title\":\"电话\",\"titleContent\":\"13862035571\",\"textContent\":\"这是一段文本\",\"top\":0,\"right\":0,\"bottom\":0,\"left\":\"80\",\"titleSize\":\"24\",\"titleColor\":\"#000\",\"contentSize\":\"24\",\"contentColor\":\"#000\"},{\"textFlag\":1,\"title\":\"手机\",\"titleContent\":\"13862035571\",\"textContent\":\"这是一段文本\",\"top\":0,\"right\":0,\"bottom\":0,\"left\":\"80\",\"titleSize\":\"24\",\"titleColor\":\"#000\",\"contentSize\":\"24\",\"contentColor\":\"#000\"},{\"textFlag\":1,\"title\":\"传真\",\"titleContent\":\"\",\"textContent\":\"这是一段文本\",\"top\":0,\"right\":0,\"bottom\":0,\"left\":\"80\",\"titleSize\":\"24\",\"titleColor\":\"#000\",\"contentSize\":\"24\",\"contentColor\":\"#000\"},{\"textFlag\":1,\"title\":\"地址\",\"titleContent\":\"江苏省苏州工业园区唯新路6号1幢1楼\",\"textContent\":\"这是一段文本\",\"top\":0,\"right\":0,\"bottom\":0,\"left\":\"80\",\"titleSize\":\"24\",\"titleColor\":\"#000\",\"contentSize\":\"24\",\"contentColor\":\"#000\"},{\"textFlag\":1,\"title\":\"邮编\",\"titleContent\":\"215002\",\"textContent\":\"这是一段文本\",\"top\":0,\"right\":0,\"bottom\":0,\"left\":\"80\",\"titleSize\":\"24\",\"titleColor\":\"#000\",\"contentSize\":\"24\",\"contentColor\":\"#000\"},{\"textFlag\":1,\"title\":\"邮件\",\"titleContent\":\"发送邮件\",\"textContent\":\"这是一段文本\",\"top\":0,\"right\":0,\"bottom\":0,\"left\":\"80\",\"titleSize\":\"24\",\"titleColor\":\"#000\",\"contentSize\":\"24\",\"contentColor\":\"#000\"},{\"textFlag\":1,\"title\":\"网址\",\"titleContent\":\"http://oact1234.atobo.com\",\"textContent\":\"这是一段文本\",\"top\":0,\"right\":0,\"bottom\":\"32\",\"left\":\"80\",\"titleSize\":\"24\",\"titleColor\":\"#000\",\"contentSize\":\"24\",\"contentColor\":\"#000\"}]},\"x\":5,\"y\":12.600000000000001,\"i\":\"CmrQ38CDA\",\"isEmpty\":false,\"moved\":false,\"height\":518,\"width\":1536,\"index\":2,\"newHeight\":\"550\"},{\"title\":\"导航栏\",\"type\":\"navbar\",\"w\":100,\"h\":1.9,\"hTotal\":50,\"newHeight\":\"38\",\"selectColor3\":2,\"direction3\":\"\",\"backgroundColor7\":\"rgba(231,197,130,1)\",\"backgroundColor8\":\"rgba(231,197,130,1)\",\"backgroundColor9\":\"rgba(231,197,130,1)\",\"componentContent\":{\"contentWidth\":\"1176\",\"contentPosition\":\"left\",\"fontSize\":\"20\",\"defaultColor\":\"rgba(26,26,26,1)\",\"defaultBgColor\":\"rgba(231,197,130,1)\",\"activeColor\":\"rgba(231,197,130,1)\",\"activeBgColor\":\"rgba(26,26,26,1)\",\"backUrl\":\"\",\"templateType\":1,\"type\":1,\"typeList\":[{\"label\":\"系统内置\",\"value\":1},{\"label\":\"自定义分类\",\"value\":2}],\"activeIndex\":\"3\",\"navbarListSys\":[{\"title\":\"首页\",\"canvasContent\":\"\",\"canvasName\":\"\",\"showFlag\":true},{\"title\":\"全部商品\",\"canvasContent\":\"\",\"canvasName\":\"\",\"showFlag\":true},{\"title\":\"企业档案\",\"canvasContent\":\"\",\"canvasName\":\"\",\"showFlag\":true},{\"title\":\"联系我们\",\"canvasContent\":\"\",\"canvasName\":\"\",\"showFlag\":true}],\"navbarList\":[{\"title\":\"首页\",\"canvasContent\":\"\",\"canvasName\":\"\",\"showFlag\":true},{\"title\":\"全部商品\",\"canvasContent\":\"\",\"canvasName\":\"\",\"showFlag\":true},{\"title\":\"企业档案\",\"canvasContent\":\"\",\"canvasName\":\"\",\"showFlag\":true},{\"title\":\"联系我们\",\"canvasContent\":\"\",\"canvasName\":\"\",\"showFlag\":true}]},\"isCanEdit1\":false,\"isCanEdit2\":false,\"isCanEdit3\":false,\"isCanEdit4\":false,\"isCanEdit5\":false,\"isCanEdit6\":false,\"isCanEdit7\":false,\"isCanEdit8\":false,\"isCanEdit9\":false,\"attrList\":[{\"title\":\"字号\",\"field\":\"isCanEdit1\",\"isCanEdit\":false},{\"title\":\"内容宽度\",\"field\":\"isCanEdit2\",\"isCanEdit\":false},{\"title\":\"内容位置\",\"field\":\"isCanEdit3\",\"isCanEdit\":false},{\"title\":\"默认颜色\",\"field\":\"isCanEdit4\",\"isCanEdit\":false},{\"title\":\"选中颜色\",\"field\":\"isCanEdit5\",\"isCanEdit\":false},{\"title\":\"选中底色\",\"field\":\"isCanEdit6\",\"isCanEdit\":false},{\"title\":\"默认底色\",\"field\":\"isCanEdit7\",\"isCanEdit\":false},{\"title\":\"背景颜色\",\"field\":\"isCanEdit8\",\"isCanEdit\":false},{\"title\":\"背景图\",\"field\":\"isCanEdit9\",\"isCanEdit\":false},{\"title\":\"默认选中\",\"field\":\"isCanEdit10\",\"isCanEdit\":false}],\"x\":0,\"y\":6.9,\"i\":\"C8aNjDayH\",\"isEmpty\":false,\"moved\":false,\"height\":38,\"width\":1707,\"imgWidth\":1707,\"imgHeight\":38,\"index\":3},{\"title\":\"店铺logo\",\"type\":\"storeLogo\",\"w\":100,\"h\":6.9,\"hTotal\":138,\"newHeight\":\"138\",\"selectColor1\":3,\"direction1\":\"right\",\"backgroundColor1\":\"#f9e7b1\",\"backgroundColor2\":\"rgba(246,225,168,1)\",\"backgroundColor3\":\"rgba(223,182,110,1)\",\"selectColor3\":2,\"direction3\":\"right\",\"backgroundColor7\":\"rgba(24,24,24,1)\",\"backgroundColor8\":\"#f9e7b1\",\"backgroundColor9\":\"#f9e7b1\",\"componentContent\":{\"fontSize1\":\"32\",\"fontSize2\":\"20\",\"fontSize3\":\"20\",\"fontSize4\":\"16\",\"logoWidth\":\"90\",\"logoHeight\":\"90\",\"contentWidth\":\"1176\",\"defaultColor\":\"rgba(231,197,130,1)\",\"phoneColor\":\"rgba(0,0,4,1)\",\"templateType\":1,\"backUrl\":\"\",\"backUrlPhone\":\"\",\"logoUrl\":\"http://39.106.56.10/dncp_resource/DNCP/picture/20230606/1/Dingtalk_20230328162909.jpg\",\"corporateName\":\"这里输入您的公司名称\",\"corporateIntro\":\"电子元件、仪表仪器\",\"phone\":\"188-8888-8888\"},\"isCanEdit1\":true,\"isCanEdit2\":true,\"isCanEdit3\":true,\"isCanEdit4\":false,\"isCanEdit5\":false,\"isCanEdit6\":false,\"isCanEdit7\":false,\"isCanEdit8\":false,\"isCanEdit9\":false,\"isCanEdit10\":false,\"isCanEdit11\":false,\"isCanEdit12\":false,\"isCanEdit13\":false,\"isCanEdit14\":false,\"isCanEdit15\":false,\"isCanEdit16\":true,\"isCanEdit17\":false,\"attrList\":[{\"title\":\"公司名称\",\"field\":\"isCanEdit1\",\"isCanEdit\":true},{\"title\":\"主营产品\",\"field\":\"isCanEdit2\",\"isCanEdit\":true},{\"title\":\"咨询热线\",\"field\":\"isCanEdit3\",\"isCanEdit\":true},{\"title\":\"字体颜色\",\"field\":\"isCanEdit4\",\"isCanEdit\":false},{\"title\":\"咨询热线字体颜色\",\"field\":\"isCanEdit5\",\"isCanEdit\":false},{\"title\":\"标题字号\",\"field\":\"isCanEdit6\",\"isCanEdit\":false},{\"title\":\"描述字号\",\"field\":\"isCanEdit7\",\"isCanEdit\":false},{\"title\":\"热线字号\",\"field\":\"isCanEdit8\",\"isCanEdit\":false},{\"title\":\"号码字号\",\"field\":\"isCanEdit9\",\"isCanEdit\":false},{\"title\":\"LOGO宽\",\"field\":\"isCanEdit10\",\"isCanEdit\":false},{\"title\":\"LOGO高\",\"field\":\"isCanEdit11\",\"isCanEdit\":false},{\"title\":\"内容宽度\",\"field\":\"isCanEdit12\",\"isCanEdit\":false},{\"title\":\"背景颜色\",\"field\":\"isCanEdit13\",\"isCanEdit\":false},{\"title\":\"咨询热线背景颜色\",\"field\":\"isCanEdit14\",\"isCanEdit\":false},{\"title\":\"背景图\",\"field\":\"isCanEdit15\",\"isCanEdit\":false},{\"title\":\"LOGO\",\"field\":\"isCanEdit16\",\"isCanEdit\":true},{\"title\":\"咨询热线背景图\",\"field\":\"isCanEdit17\",\"isCanEdit\":false}],\"x\":0,\"y\":0,\"i\":\"CrFj4ErNh\",\"isEmpty\":false,\"moved\":false,\"height\":138,\"width\":1707,\"backgroundHeight\":138,\"backgroundWidth\":1707,\"logoHeight\":116,\"logoWidth\":110,\"informationHeight\":38,\"informationWidth\":182,\"index\":4,\"imgUrl\":\"http://39.106.56.10/dncp_resource/DNCP/picture/20230606/1/Dingtalk_20230328162909.jpg\"}]";
        String source = "[{\"contentWidth\":\"323\",\"componentContent\":{\"imgFlag\":\"2\",\"imgUrl\":\"static/img/baner3.32323232.png\",\"imgName\":\"图片名称22哦\"},\"i\":\"CSyNH7yRW\"},{\"title\":\"信息模板1212\",\"componentContent\":{\"textData\":[{\"textFlag\":\"1\",\"title\":\"联系人111\",\"titleContent\":\"徐工111\",\"textContent\":\"这是一段文本111\",\"newFiedl\":\"newField1\"}]},\"i\":\"CmrQ38CDA\"}]";

        List<JSONObject> targetList = JSON.parseArray(target, JSONObject.class);
        List<JSONObject> sourceList = JSON.parseArray(source, JSONObject.class);
        Map<String, JSONObject> targetMap = targetList.stream().collect(Collectors.toMap(item -> item.getString("i"), Function.identity()));

        sourceList.forEach(item -> {
            JSONObject targetObj = targetMap.get(item.getString("i"));
            if (ObjectUtil.isNotEmpty(targetObj)) {
                targetMap.put(item.getString("i"), JSONUtil.merge(item, targetMap.get(item.getString("i"))));
            }
        });

        System.out.println(JSON.toJSONString(targetMap.values()));
    }
}
